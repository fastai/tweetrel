---

title: Tutorial: Creating tweetrel


keywords: fastai
sidebar: home_sidebar

summary: "and an overview of its API"
description: "and an overview of its API"
nb_path: "00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to create this library, we will start out by following the initial steps of the <a href="https://nbdev.fast.ai/tutorial.html">nbdev tutorial</a> to create a basic project structure. We also need to install <a href="https://ghapi.fast.ai/">ghapi</a>, by following the instructions on that link.</p>
<p>Once we have a repo cloned, based on the <code>nbdev_template</code> template, we run in our terminal:</p>
<div class="highlight"><pre><span></span>gh-create-workflow tweet release --contexts secrets
</pre></div>
<p>Note that we add <code>--contexts secrets</code> because we'll need access to the <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets#using-encrypted-secrets-in-a-workflow">secrets context</a>, which we'll be using to store our Twitter API keys.</p>
<p>The basic workflow skeleton that this creates is:</p>
<div class="highlight"><pre><span></span>.github/workflows/tweet-release.yml
.github/scripts/build-tweet-release.py
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setting-up-Twitter-authentication">Setting up Twitter authentication<a class="anchor-link" href="#Setting-up-Twitter-authentication"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to send tweets, we'll send to use the Twitter API -- we'll use the <code>tweepy</code> library for this:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tweepy</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You'll need a <a href="https://developer.twitter.com/en/apply-for-access">Twitter API login</a>. If you need to send Tweets on behalf of a different user to the one attached to your login, you'll need to authenticate with Twitter as that user. Run <code>tweetrel-auth</code> in your terminal and follow the instructions to get those access tokens.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="auth" class="doc_header"><code>auth</code><a href="https://github.com/fastai/tweetrel/tree/master/tweetrel/core.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>auth</code>()</p>
</blockquote>
<p>Function for <code>tweetrel-auth</code> CLI command</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Twitter part of this tutorial isn't the main thing we want to explain, but the thing to note carefully here is how to access <em>secrets</em> in your workflow.</p>
<p>The Twitter API requires authentication, so we'll store our details in a GitHub secret. We'll just use one secret, we our keys stored space delimited. We generally use an <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-an-organization">organization secret</a>, so that we can update secrets in one place as needed.</p>
<p>Contexts are passed to ghapi as json-encoded environment variables. Each variable name starts with <code>CONTEXT_</code> -- so for instance the <code>secrets</code> context is <code>CONTEXT_SECRETS</code>. In order to simulate this when testing, ensure that you have set an appropriate environment variable before importing <code>ghapi</code>. We'll put our JSON encoded secrets for testing into a <code>.secrets</code> file (which we add to <code>.gitignore</code> so it won't be pushed to our repo). We put the four parts (<code>consumer_key</code>, <code>consumer_secret</code>, <code>access_token</code>, and <code>access_token_secret</code>) into a single space delimited secret.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CONTEXT_SECRETS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.secrets&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can import <code>ghapi</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ghapi.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you now check the <code>context_secrets</code> variable, you should find your secrets available as an <code>AttrDict</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="s1">&#39;TWITTER&#39;</span> <span class="ow">in</span> <span class="n">context_secrets</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we'll create a function to unpack our keys, tokens, and secrets for Twitter auth, and login to the API:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="twitter_api" class="doc_header"><code>twitter_api</code><a href="https://github.com/fastai/tweetrel/tree/master/tweetrel/core.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>twitter_api</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">twitter_api</span><span class="p">():</span>
    <span class="n">consumer_key</span><span class="p">,</span><span class="n">consumer_secret</span><span class="p">,</span><span class="n">access_token</span><span class="p">,</span><span class="n">access_token_secret</span> <span class="o">=</span> <span class="n">context_secrets</span><span class="o">.</span><span class="n">TWITTER</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span><span class="n">consumer_secret</span><span class="p">)</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span><span class="n">access_token_secret</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can test our login by creating and deleting a tweet:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">twapi</span> <span class="o">=</span> <span class="n">twitter_api</span><span class="p">()</span>
<span class="n">stat</span> <span class="o">=</span> <span class="n">twapi</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Please ignore - testing API&quot;</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">twapi</span><span class="o">.</span><span class="n">destroy_status</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Responding-to-the-release-event">Responding to the <code>release</code> event<a class="anchor-link" href="#Responding-to-the-release-event"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can get a sample <code>release</code> event payload as follows:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_rel</span> <span class="o">=</span> <span class="n">example_payload</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">example_rel</span><span class="p">),</span> <span class="n">example_rel</span><span class="o">.</span><span class="n">action</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>([&#39;action&#39;, &#39;release&#39;, &#39;repository&#39;, &#39;sender&#39;], &#39;published&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>release</code> section has the following keys:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">example_rel</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;url, assets_url, upload_url, html_url, id, node_id, tag_name, target_commitish, name, draft, author, prerelease, created_at, published_at, assets, tarball_url, zipball_url, body&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can create a function that formats a tweet based on this information, which will take the template from an environment variable if available, otherwise will use a reasonable default:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tweet_text" class="doc_header"><code>tweet_text</code><a href="https://github.com/fastai/tweetrel/tree/master/tweetrel/core.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tweet_text</code>(<strong><code>payload</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">tweet_text</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;workflow&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">example_rel</span>
    <span class="n">def_tmpl</span> <span class="o">=</span> <span class="s2">&quot;New #</span><span class="si">{repo}</span><span class="s2"> release: v</span><span class="si">{tag_name}</span><span class="s2">. </span><span class="si">{html_url}</span><span class="se">\n\n</span><span class="si">{body}</span><span class="s2">&quot;</span>
    <span class="n">tweet_tmpl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TWEETREL_TEMPLATE&#39;</span><span class="p">,</span> <span class="n">def_tmpl</span><span class="p">)</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">release</span>
    <span class="n">owner</span><span class="p">,</span><span class="n">repo</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">tweet_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">repo</span><span class="o">=</span><span class="n">repo</span><span class="p">,</span> <span class="n">tag_name</span><span class="o">=</span><span class="n">rel</span><span class="o">.</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">html_url</span><span class="o">=</span><span class="n">rel</span><span class="o">.</span><span class="n">html_url</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">rel</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">280</span> <span class="k">else</span> <span class="p">(</span><span class="n">res</span><span class="p">[:</span><span class="mi">279</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;…&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>...and test it:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tweet_text</span><span class="p">(</span><span class="n">example_rel</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>New #Hello-World release: v0.0.1. https://github.com/Codertocat/Hello-World/releases/tag/0.0.1

None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The sample release payload from GitHub happens to have an empty <code>body</code>, but other than that, this looks good.</p>
<p>That's all we need to create our function:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="send_tweet" class="doc_header"><code>send_tweet</code><a href="https://github.com/fastai/tweetrel/tree/master/tweetrel/core.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>send_tweet</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">send_tweet</span><span class="p">():</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">context_github</span><span class="o">.</span><span class="n">event</span>
    <span class="k">if</span> <span class="s1">&#39;workflow&#39;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">example_payload</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">payload</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;published&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="n">twitter_api</span><span class="p">()</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">tweet_text</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can pop this into our python script, along with <code>send_tweet()</code>. Since we're using nbdev, we can enter the following in our terminal to do all that:</p>
<div class="highlight"><pre><span></span>nbdev_build_lib
cp tweetrel/core.py .github/scripts/build-tweet-release.py
<span class="nb">echo</span> -e <span class="s2">&quot;\nsend_tweet()&quot;</span> &gt;&gt;  .github/scripts/build-tweet-release.py
</pre></div>
<p>After we push to GitHub, we can test it out in the same way we showed in the <a href="https://ghapi.fast.ai/tutorial_actions.html">GitHub Actions tutorial</a>, first by logging in and getting a reference to our workflow:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">api</span> <span class="o">=</span> <span class="n">GhApi</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="s1">&#39;fastai&#39;</span><span class="p">,</span> <span class="n">repo</span><span class="o">=</span><span class="s1">&#39;tweetrel&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">github_token</span><span class="p">())</span>
<span class="n">wf</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">get_workflow</span><span class="p">(</span><span class="s1">&#39;tweet-release.yml&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and then running it:</p>
<div class="highlight"><pre><span></span><span class="n">api</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">create_workflow_dispatch</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;master&#39;</span><span class="p">)</span>
</pre></div>
<p>After you run this, you should find the workflow appears in your "Actions" tab on GitHub, and a tweet will appear in your twitter timeline.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Some-little-improvements">Some little improvements<a class="anchor-link" href="#Some-little-improvements"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One issue is that currently you'll see three workflows being triggered on the Actions tab in GitHub. That's because the "created" and "released" types are resulting in a trigger, as well as "published". Our function is checking which is being used, and only tweeting for "published", but the runs are still being recorded. This isn't necessarily a big problem, but if you'd like things to be cleaner, you can edit the <code>tweet-release.yml</code> file to add the following line after the <code>release:</code> line:</p>
<div class="highlight"><pre><span></span>types: <span class="o">[</span>published<span class="o">]</span>
</pre></div>
<p>It's also possible to do a more complete end-to-end test by actually making a release, checking that a new run is created, and checking the result of that run:</p>
<div class="highlight"><pre><span></span><span class="n">n_runs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">list_workflow_runs</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">total_count</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">create_release</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">runs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">list_workflow_runs</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">test</span><span class="p">(</span><span class="n">runs</span><span class="o">.</span><span class="n">total_count</span><span class="p">,</span> <span class="n">n_runs</span><span class="p">,</span> <span class="n">gt</span><span class="p">)</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">runs</span><span class="o">.</span><span class="n">workflow_runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">conclusion</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span> <span class="n">api</span><span class="o">.</span><span class="n">delete_release</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Distributing-your-new-Action">Distributing your new Action<a class="anchor-link" href="#Distributing-your-new-Action"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The above steps are all that's needed to create a Python-based workflow for use in a single project. To make it accessible for any project (including other people's projects), we need to distribute it. The easiest way to do that is with <code>pip</code>. <code>pip</code> can install modules directly from GitHub, or from the PyPi repository.</p>
<p>Our first step is to add a command that makes it easy to install the <code>tweetrel</code> workflow into a project. We can use <code>fastcore.script.call_parse</code> to create a function that can be run from the terminal.</p>
<p>In the function, we'll use <code>fill_workflow_templates</code> instead of <code>gh-create-workflow</code> because it allows us to customize each part of the YAML workflow file exactly as we need it:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="install" class="doc_header"><code>install</code><a href="https://github.com/fastai/tweetrel/tree/master/tweetrel/core.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>install</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@call_parse</span>
<span class="k">def</span> <span class="nf">install</span><span class="p">():</span>
    <span class="n">fill_workflow_templates</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;release:</span><span class="se">\n</span><span class="s2">  types: [published]&quot;</span><span class="p">,</span>
        <span class="n">run</span><span class="o">=</span><span class="s1">&#39;pip install -Uq tweetrel&#39;</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="n">env_contexts</span><span class="p">(</span><span class="s1">&#39;secrets&#39;</span><span class="p">),</span>
        <span class="n">script</span><span class="o">=</span><span class="s2">&quot;import tweetrel</span><span class="se">\n</span><span class="s2">tweetrel.send_tweet()&quot;</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case, we just used <code>tweetrel</code> in the "pip install" line, which assumes that the project has been uploaded to pypi (which you can do by typing <code>make release</code> in your terminal, if you use nbdev or <a href="https://github.com/fastai/pypi_template">pypi_template</a>. If you are just installing from GitHub directly, you'd use this instead:</p>
<div class="highlight"><pre><span></span><span class="n">run</span><span class="o">=</span><span class="s1">&#39;pip install -Uq git+https://github.com/fastai/tweetrel.git&#39;</span><span class="p">,</span>
</pre></div>
<p>Since <a href="/core.html#install"><code>install</code></a> uses <code>call_parse</code>, we can run it as a standard Python function, so we can test it by executing the function:</p>
<div class="highlight"><pre><span></span><span class="n">install</span><span class="p">()</span>
</pre></div>
<p>Alternatively, we can run it through the CLI, by first adding to our <code>settings.ini</code>:</p>
<div class="highlight"><pre><span></span><span class="nv">console_scripts</span> <span class="o">=</span> tweetrel-install<span class="o">=</span>tweetrel.core:install
</pre></div>
<p>...and then installing our library locally:</p>
<div class="highlight"><pre><span></span>pip install -e .
</pre></div>
<p>...and finaly running the command:</p>
<div class="highlight"><pre><span></span>tweetrel-install
</pre></div>
<p>If this all works, then you can run <code>make release</code> to submit your action to pypi and conda, making it available for anyone to use in their workflows.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By following these steps, we have created a Python-based GitHub Action, which can be installed using pip or conda, and can be added to any repo with a single command. See the overview page for this module to see how we document this for end users of the action.</p>

</div>
</div>
</div>
</div>
 

